{% if current_buffer_path or current_buffer_context or context_files %}
CONTEXT:
{% endif %}
{% if current_buffer_path %}
Document:0
Title: {{ current_buffer_path }}
{% endif %}
{% if current_buffer_context %}
Content:
```{{ current_buffer_filetype }}
{{ current_buffer_context }}
```
{% endif %}
{% if context_files %}
  {% for file in context_files %}
Document:{{ loop.index }}
Title: {{ file.path }}
Content:
```
{{file.content}}
```
  {% endfor %}
{% endif %}
{% if visual_selection %}
Code:
```{{ current_buffer_filetype }}
{{ visual_selection }}
```

  {% if prefill %}
INSTRUCTION: Replace the code in the block given above. ONLY return the valid code fragment surrounded by a code fence with backticks.
  {% else %}
INSTRUCTION: Replace the code in the block given above. ONLY return the code fragment that is requested in the code snippet WITHOUT backticks. DO NOT surround the code fragment in backticks.
  {% endif %}
{% else %}
INSTRUCTION: Follow the user query from the position marked with <CURSOR_POS>. ONLY return the code fragment that is requested in the query WITHOUT backticks. DO NOT surround the code fragment in backticks.
{% endif %}
QUERY: {{ user_query }}
